<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Atto: Atto - the microscopic C unit test framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Atto
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   <div id="projectbrief">The microscopic C test framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Atto - the microscopic C unit test framework </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p><a href="https://github.com/TheMatjaz/atto/actions/workflows/build_master.yml"><img src="https://github.com/TheMatjaz/atto/actions/workflows/build_master.yml/badge.svg" alt="Build Status Master" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/TheMatjaz/atto/actions/workflows/build_develop.yml"><img src="https://github.com/TheMatjaz/atto/actions/workflows/build_develop.yml/badge.svg" alt="Build Status Develop" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/TheMatjaz/atto/releases/latest"><img src="https://img.shields.io/github/v/release/TheMatjaz/atto" alt="GitHub release (latest by date)" class="inline"/></a> <a href="https://github.com/TheMatjaz/atto/blob/master/LICENSE.md"><img src="https://img.shields.io/github/license/TheMatjaz/atto" alt="GitHub" class="inline"/></a></p>
<p>Atto is the simplest-to-use C unit test framework, in just one header file, without <code>malloc()</code>, without <code>fork()</code>, without dependencies, ready for embedded systems that can at least call <code>printf()</code> - and even those who cannot, can easily adapt it!</p>
<p>Most probably you will understand most about Atto if you just read its header: <a href="src/atto.h"><code>atto.h</code></a>. I promise it's not that long, if you exclude the documentation.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Why should I use Atto instead of another framework?</h1>
<p>The goal of a unit test is generally very simple: verify that the obtained value equals to the expected one. More generally if a boolean expression is true (e.g. a value is in the allowed range).</p>
<p>There are so many complex unit test frameworks to do this in C and C++ which just increases complexity of the whole project. Suppose you are just writing a simple program and want to test it. Oh, boy! Start managing the dependencies for the framework, check if you can install it, maybe you need Docker etc. Some frameworks even require <code>fork()</code> - how could that work on an embedded system?</p>
<p>Atto is born to remove all of that complexity. Heavily inspired by <a href="http://www.jera.com/techinfo/jtns/jtn002.html">MinUnit</a>, which has <b>just 3 lines of code</b>, Atto is just a header file you can include statically (copy-paste) in your project and start writing your tests. Atto is so tiny that even <a href="https://en.wikipedia.org/wiki/Atto-">its name means "tiny"</a> ;)</p>
<p>The output is basic, but enough: indicates just where the test case failed, by filename and line number. Open that file, go to that line. There is the error. Start using the debugger around that point.</p>
<p>Passing tests are not printed, to avoid cluttering the output. You can still explicitly request a status report at any point in the test suite codebase (e.g. after a cluster of testcases of similar nature) with <code><a class="el" href="atto_8h.html#a2a702c85a1bfe1de6e162b91442e6cca" title="Prints a brief report message providing the point where this report is and the amount of successes an...">atto_report()</a></code>.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Dependencies</h1>
<p>Only the C standard library!</p>
<ul>
<li><code>stdio.h</code>, for <code>printf()</code> - if your system does not have it, replace the <b>one</b> call of <code>printf()</code> in <code><a class="el" href="atto_8h.html" title="Atto - the microscopic C unit test framework.">atto.h</a></code> with something else!</li>
<li><code>math.h</code>, for <code>fabs()</code>, <code>fabsf()</code>, <code>isnan()</code>, <code>isinf()</code>, <code>isfinite()</code></li>
<li><code>string.h</code>, for <code>strncmp()</code>, <code>memcmp()</code></li>
<li><code>stddef.h</code> for <code>size_t</code></li>
</ul>
<p><b>No <code>malloc()</code> or <code>fork()</code> required</b></p>
<h1><a class="anchor" id="autotoc_md5"></a>
How to use</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Basic idea and example</h2>
<p>Use the <code>atto_*</code> macros in your test cases.</p>
<p>Here is an example where we test the <code>sqrt()</code> function from <code>math.h</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="atto_8h.html">atto.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> test_sqrt_valid_values(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="atto_8h.html#a5cb0190da3137ec0a09dc92e71511605">atto_eq</a>(0.0, sqrt(0.0));</div>
<div class="line">    <a class="code" href="atto_8h.html#a5cb0190da3137ec0a09dc92e71511605">atto_eq</a>(1.0, sqrt(1.0));</div>
<div class="line">    <a class="code" href="atto_8h.html#a5cb0190da3137ec0a09dc92e71511605">atto_eq</a>(2.0, sqrt(4.0));</div>
<div class="line">    <a class="code" href="atto_8h.html#a5ebb0ffeb0141eeab8e78e1ef1f29e78">atto_ddelta</a>(1.4142, sqrt(2.0), 0.001);</div>
<div class="line">    <a class="code" href="atto_8h.html#a5ebb0ffeb0141eeab8e78e1ef1f29e78">atto_ddelta</a>(1.7321, sqrt(3.0), 1e-8); <span class="comment">// This fails!</span></div>
<div class="line">                                          <span class="comment">// 1.7321 is not accurate enough</span></div>
<div class="line">                                          <span class="comment">// The test case stops here.</span></div>
<div class="line">    <a class="code" href="atto_8h.html#a5ebb0ffeb0141eeab8e78e1ef1f29e78">atto_ddelta</a>(2.2361, sqrt(5.0), 1e-8); <span class="comment">// This is NOT executed!</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> test_sqrt_negative_values(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="atto_8h.html#aa992536981ea831648108ade64ff21cc">atto_nan</a>(sqrt(-1.0));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    test_sqrt_valid_values();</div>
<div class="line">    test_sqrt_negative_values();</div>
<div class="line">    <a class="code" href="atto_8h.html#a2a702c85a1bfe1de6e162b91442e6cca">atto_report</a>();  <span class="comment">// Print a small one-line status report</span></div>
<div class="line">    <span class="comment">// Looks approximately like this</span></div>
<div class="line">    <span class="comment">// REPORT | File: /path/to/my/file.c:27 | Test case: main | Passes: 5 | Failures: 1</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="atto_8h.html#a075b61dac7ea4c759a9212f9600887d7">atto_at_least_one_fail</a>; <span class="comment">// Non-zero in case of error to provide a proper exit-code</span></div>
<div class="line">}</div>
<div class="ttc" id="aatto_8h_html"><div class="ttname"><a href="atto_8h.html">atto.h</a></div><div class="ttdoc">Atto - the microscopic C unit test framework.</div></div>
<div class="ttc" id="aatto_8h_html_a075b61dac7ea4c759a9212f9600887d7"><div class="ttname"><a href="atto_8h.html#a075b61dac7ea4c759a9212f9600887d7">atto_at_least_one_fail</a></div><div class="ttdeci">char atto_at_least_one_fail</div><div class="ttdoc">Boolean indicating if all tests passed successfully (when 0) or not.</div></div>
<div class="ttc" id="aatto_8h_html_a2a702c85a1bfe1de6e162b91442e6cca"><div class="ttname"><a href="atto_8h.html#a2a702c85a1bfe1de6e162b91442e6cca">atto_report</a></div><div class="ttdeci">#define atto_report()</div><div class="ttdoc">Prints a brief report message providing the point where this report is and the amount of successes an...</div><div class="ttdef"><b>Definition:</b> atto.h:108</div></div>
<div class="ttc" id="aatto_8h_html_a5cb0190da3137ec0a09dc92e71511605"><div class="ttname"><a href="atto_8h.html#a5cb0190da3137ec0a09dc92e71511605">atto_eq</a></div><div class="ttdeci">#define atto_eq(a, b)</div><div class="ttdoc">Verifies if the two arguments are exactly equal.</div><div class="ttdef"><b>Definition:</b> atto.h:186</div></div>
<div class="ttc" id="aatto_8h_html_a5ebb0ffeb0141eeab8e78e1ef1f29e78"><div class="ttname"><a href="atto_8h.html#a5ebb0ffeb0141eeab8e78e1ef1f29e78">atto_ddelta</a></div><div class="ttdeci">#define atto_ddelta(a, b, delta)</div><div class="ttdoc">Verifies if two double-precision floating point values are within a given absolute tolerance from eac...</div><div class="ttdef"><b>Definition:</b> atto.h:307</div></div>
<div class="ttc" id="aatto_8h_html_aa992536981ea831648108ade64ff21cc"><div class="ttname"><a href="atto_8h.html#aa992536981ea831648108ade64ff21cc">atto_nan</a></div><div class="ttdeci">#define atto_nan(value)</div><div class="ttdoc">Verifies that the floating point value is Not a Number (NaN).</div><div class="ttdef"><b>Definition:</b> atto.h:340</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Real-world examples</h2>
<p>Check some of my other personal projects, where I use Atto for unit testing!</p>
<ul>
<li><a href="https://github.com/TheMatjaz/LibAscon">LibAscon</a></li>
<li><a href="https://github.com/TheMatjaz/LibISAAC">LibISAAC</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Complete recipe for the creation of a test suite with Atto</h2>
<ol type="1">
<li>Add the files <code><a class="el" href="atto_8h.html" title="Atto - the microscopic C unit test framework.">atto.h</a></code>, <code>atto.c</code> to your project:<ul>
<li>You can copy the whole <code>src</code> folder into your project. This is probably the fastest and simplest solution.</li>
<li>Alternatively, use <code>git subtree</code> to include this repo into your own</li>
</ul>
</li>
<li>Create a file with your tests, say <code>test.c</code>.</li>
<li>Add test case functions returning <code>void</code> to <code>test.c</code>, as the two <code>test_sqrt_*</code> functions in the example above.</li>
<li>In each test case call <code><a class="el" href="atto_8h.html#af85ba4f5d08d45055206f43587cab6d0" title="Verifies if the given boolean expression is true.">atto_assert()</a></code>, <code><a class="el" href="atto_8h.html#a5cb0190da3137ec0a09dc92e71511605" title="Verifies if the two arguments are exactly equal.">atto_eq()</a></code>, <code><a class="el" href="atto_8h.html#a600ba63e783cc4eadd77a4007dcf210a" title="Verifies if the bits of the value specified by a bit mask are set to 1.">atto_flag()</a></code> etc. to verify the values you are testing. On a fail, the test case is terminated early and the lines of code after that are not executed.</li>
<li>Add a <code>main()</code> function to <code>test.c</code> which returns <code>atto_at_least_one_fail</code>. By doing so, the exit code of the test executable will be <code>1</code> in case at least one test failed. Particularly useful when running the test executables in a pipeline that should stop when something is broken. Of course on embedded systems one can use <code>atto_at_least_one_fail</code> in different ways, as there is no returning from <code>main</code>; for example by transmitting it via UART.</li>
<li>Call the test case functions from the <code>main()</code>.</li>
<li>Compile <code>test.c</code> into an executable and run it.</li>
<li>Check its standard output and the process exit code for failed tests.</li>
<li>Bonus: add some calls to <code><a class="el" href="atto_8h.html#a2a702c85a1bfe1de6e162b91442e6cca" title="Prints a brief report message providing the point where this report is and the amount of successes an...">atto_report()</a></code> wherever you want in the test suite code. At least one call at the very end (before the <code>main</code> returns) is suggested, but also after a set of similar test cases is a good choice to see where something is making the test suite crash, in case so happens.</li>
</ol>
<h2><a class="anchor" id="autotoc_md13"></a>
A test case is failing. Now what?</h2>
<p>The output will contain one or more lines like:</p>
<div class="fragment"><div class="line">FAIL | File: /path/to/some_project/test.c:182 | Test case: test_valid_input_length</div>
</div><!-- fragment --><ol type="1">
<li>Open the file <code>/path/to/some_project/test.c</code></li>
<li><p class="startli">Go to line 182 (use some keyboard shortcut), which is in the function <code>test_valid_input_length()</code></p>
<p class="startli">Note: sometimes the <code>path:linenumber</code> pattern is identified as clickable by your IDE. Maybe that speeds up your search.</p>
</li>
<li>The assertion on that specific line failed. Now up to you to debug why. The easiest way is to place a debugger breakpoint earlier in the test case.</li>
</ol>
<p>Once the standard output does not contain any <code>FAIL</code> lines and the exit code of the process is <code>0</code>, you are good to go!</p>
<h2><a class="anchor" id="autotoc_md15"></a>
But this framework does not fit my needs!</h2>
<p>It may not be the best solution for your scenario - it was born for my personal projects where I needed something simple. You are more than welcome to customize it to your needs within your project or simply to use other frameworks. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
